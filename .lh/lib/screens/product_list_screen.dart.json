{
    "sourceFile": "lib/screens/product_list_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1764487627021,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764491548387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,16 @@\n-// ignore_for_file: unnecessary_null_comparison\n-\n import 'package:flutter/material.dart';\n import 'package:flutter_spinkit/flutter_spinkit.dart';\n import 'package:provider/provider.dart';\n \n import '../models/product.dart';\n import '../providers/product_provider.dart';\n+import '../utils/navigation_utils.dart';\n import '../widgets/product_card.dart';\n import 'add_product_screen.dart';\n \n class ProductListScreen extends StatefulWidget {\n-  const ProductListScreen({Key? key}) : super(key: key);\n+  const ProductListScreen({super.key});\n \n   @override\n   State<ProductListScreen> createState() => _ProductListScreenState();\n }\n@@ -19,8 +18,9 @@\n class _ProductListScreenState extends State<ProductListScreen> {\n   late ProductProvider productProvider;\n   TextEditingController searchController = TextEditingController();\n   List<Product> filteredProducts = [];\n+  String _sortOption = 'default'; // default, lowToHigh, highToLow\n \n   @override\n   void initState() {\n     super.initState();\n@@ -29,46 +29,139 @@\n       productProvider = Provider.of<ProductProvider>(context, listen: false);\n       productProvider.loadProducts();\n       productProvider.loadLocalProducts();\n     });\n-    searchController.addListener(_filterProducts);\n+    searchController.addListener(_filterAndSortProducts);\n   }\n \n-  void _filterProducts() {\n+  void _filterAndSortProducts() {\n     setState(() {\n-      if (productProvider != null) {\n+      if (mounted) {\n+        // First filter products\n         filteredProducts = productProvider.filterProducts(\n           searchController.text,\n         );\n+        // Then sort based on selected option\n+        _sortProducts();\n       }\n     });\n   }\n \n+  void _sortProducts() {\n+    switch (_sortOption) {\n+      case 'lowToHigh':\n+        filteredProducts.sort((a, b) => a.price.compareTo(b.price));\n+        break;\n+      case 'highToLow':\n+        filteredProducts.sort((a, b) => b.price.compareTo(a.price));\n+        break;\n+      default:\n+        // Keep original order\n+        break;\n+    }\n+  }\n+\n   @override\n   void dispose() {\n-    searchController.removeListener(_filterProducts);\n+    searchController.removeListener(_filterAndSortProducts);\n     searchController.dispose();\n     super.dispose();\n   }\n \n+  // Method to refresh products\n+  void _refreshProducts() {\n+    final provider = Provider.of<ProductProvider>(context, listen: false);\n+    provider.loadProducts();\n+  }\n+\n+  // Method to show sort options\n+  void _showSortOptions() {\n+    showModalBottomSheet(\n+      context: context,\n+      shape: const RoundedRectangleBorder(\n+        borderRadius: BorderRadius.vertical(top: Radius.circular(20)),\n+      ),\n+      builder: (BuildContext context) {\n+        return SafeArea(\n+          child: Column(\n+            mainAxisSize: MainAxisSize.min,\n+            children: [\n+              const Padding(\n+                padding: EdgeInsets.all(16.0),\n+                child: Text(\n+                  'Sort by Price',\n+                  style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),\n+                ),\n+              ),\n+              ListTile(\n+                title: const Text('Default'),\n+                trailing: _sortOption == 'default'\n+                    ? const Icon(Icons.check, color: Colors.blue)\n+                    : null,\n+                onTap: () {\n+                  setState(() {\n+                    _sortOption = 'default';\n+                    _filterAndSortProducts();\n+                  });\n+                  Navigator.pop(context);\n+                },\n+              ),\n+              ListTile(\n+                title: const Text('Price: Low to High'),\n+                trailing: _sortOption == 'lowToHigh'\n+                    ? const Icon(Icons.check, color: Colors.blue)\n+                    : null,\n+                onTap: () {\n+                  setState(() {\n+                    _sortOption = 'lowToHigh';\n+                    _filterAndSortProducts();\n+                  });\n+                  Navigator.pop(context);\n+                },\n+              ),\n+              ListTile(\n+                title: const Text('Price: High to Low'),\n+                trailing: _sortOption == 'highToLow'\n+                    ? const Icon(Icons.check, color: Colors.blue)\n+                    : null,\n+                onTap: () {\n+                  setState(() {\n+                    _sortOption = 'highToLow';\n+                    _filterAndSortProducts();\n+                  });\n+                  Navigator.pop(context);\n+                },\n+              ),\n+            ],\n+          ),\n+        );\n+      },\n+    );\n+  }\n+\n   @override\n   Widget build(BuildContext context) {\n     return Scaffold(\n       appBar: AppBar(\n         title: const Text('Products'),\n         backgroundColor: Theme.of(context).primaryColor,\n         foregroundColor: Colors.white,\n+        actions: [\n+          IconButton(icon: const Icon(Icons.sort), onPressed: _showSortOptions),\n+          IconButton(\n+            icon: const Icon(Icons.refresh),\n+            onPressed: _refreshProducts,\n+          ),\n+        ],\n       ),\n       body: Consumer<ProductProvider>(\n         builder: (context, provider, child) {\n-          // Initialize filtered products on first build\n-          if (filteredProducts.isEmpty && provider.products.isNotEmpty) {\n-            filteredProducts = List.from(provider.products);\n+          // Update filtered products when the main list changes\n+          if (provider.products.isNotEmpty) {\n+            filteredProducts = provider.filterProducts(searchController.text);\n+            _sortProducts();\n           }\n \n-          // Set productProvider for use in other methods\n-          productProvider = provider;\n-\n           return Column(\n             children: [\n               // Search Bar\n               Padding(\n@@ -84,64 +177,69 @@\n                     ),\n                     filled: true,\n                     fillColor: Colors.grey[200],\n                   ),\n+                  onChanged: (value) {\n+                    setState(() {\n+                      filteredProducts = provider.filterProducts(value);\n+                      _sortProducts();\n+                    });\n+                  },\n                 ),\n               ),\n-              // Loading Indicator\n-              if (provider.isLoading)\n-                const Padding(\n-                  padding: EdgeInsets.all(16.0),\n-                  child: SpinKitCircle(color: Colors.blue, size: 50.0),\n-                )\n-              else if (provider.errorMessage.isNotEmpty)\n-                Padding(\n-                  padding: const EdgeInsets.all(16.0),\n-                  child: Column(\n-                    children: [\n-                      Text(\n-                        provider.errorMessage,\n-                        style: const TextStyle(color: Colors.red),\n-                      ),\n-                      ElevatedButton(\n-                        onPressed: () {\n-                          provider.loadProducts();\n+              // Loading Indicator or Product List\n+              Expanded(\n+                child: provider.isLoading\n+                    ? const Center(\n+                        child: SpinKitCircle(color: Colors.blue, size: 50.0),\n+                      )\n+                    : provider.errorMessage.isNotEmpty\n+                    ? Padding(\n+                        padding: const EdgeInsets.all(16.0),\n+                        child: Column(\n+                          mainAxisAlignment: MainAxisAlignment.center,\n+                          children: [\n+                            Text(\n+                              provider.errorMessage,\n+                              style: const TextStyle(color: Colors.red),\n+                              textAlign: TextAlign.center,\n+                            ),\n+                            const SizedBox(height: 16),\n+                            ElevatedButton(\n+                              onPressed: _refreshProducts,\n+                              child: const Text('Retry'),\n+                            ),\n+                          ],\n+                        ),\n+                      )\n+                    : RefreshIndicator(\n+                        onRefresh: () async {\n+                          await provider.loadProducts();\n                         },\n-                        child: const Text('Retry'),\n+                        child: ListView.builder(\n+                          itemCount: filteredProducts.length,\n+                          itemBuilder: (context, index) {\n+                            return ProductCard(\n+                              product: filteredProducts[index],\n+                            );\n+                          },\n+                        ),\n                       ),\n-                    ],\n-                  ),\n-                )\n-              else\n-                // Product List\n-                Expanded(\n-                  child: RefreshIndicator(\n-                    onRefresh: () async {\n-                      await provider.loadProducts();\n-                    },\n-                    child: ListView.builder(\n-                      itemCount: filteredProducts.length,\n-                      itemBuilder: (context, index) {\n-                        return ProductCard(product: filteredProducts[index]);\n-                      },\n-                    ),\n-                  ),\n-                ),\n+              ),\n             ],\n           );\n         },\n       ),\n       floatingActionButton: FloatingActionButton(\n-        onPressed: () {\n-          Navigator.push(\n+        onPressed: () async {\n+          final result = await Navigator.push(\n             context,\n-            MaterialPageRoute(builder: (context) => const AddProductScreen()),\n-          ).then((value) {\n-            // Refresh products when returning from add screen\n-            if (value == true) {\n-              productProvider.loadProducts();\n-            }\n-          });\n+            NavigationUtils.createSlideRoute(const AddProductScreen()),\n+          );\n+          // Refresh products when returning from add screen\n+          if (result == true) {\n+            _refreshProducts();\n+          }\n         },\n         backgroundColor: Theme.of(context).primaryColor,\n         child: const Icon(Icons.add),\n       ),\n"
                },
                {
                    "date": 1764491558105,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,9 +35,9 @@\n \n   void _filterAndSortProducts() {\n     setState(() {\n       if (mounted) {\n-        // First filter products\n+        \n         filteredProducts = productProvider.filterProducts(\n           searchController.text,\n         );\n         // Then sort based on selected option\n"
                },
                {
                    "date": 1764491564632,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,9 +39,9 @@\n         \n         filteredProducts = productProvider.filterProducts(\n           searchController.text,\n         );\n-        // Then sort based on selected option\n+      \n         _sortProducts();\n       }\n     });\n   }\n@@ -54,9 +54,9 @@\n       case 'highToLow':\n         filteredProducts.sort((a, b) => b.price.compareTo(a.price));\n         break;\n       default:\n-        // Keep original order\n+       \n         break;\n     }\n   }\n \n"
                },
                {
                    "date": 1764491572371,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,15 +66,13 @@\n     searchController.dispose();\n     super.dispose();\n   }\n \n-  // Method to refresh products\n   void _refreshProducts() {\n     final provider = Provider.of<ProductProvider>(context, listen: false);\n     provider.loadProducts();\n   }\n \n-  // Method to show sort options\n   void _showSortOptions() {\n     showModalBottomSheet(\n       context: context,\n       shape: const RoundedRectangleBorder(\n"
                },
                {
                    "date": 1764491581777,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,9 +152,8 @@\n         ],\n       ),\n       body: Consumer<ProductProvider>(\n         builder: (context, provider, child) {\n-          // Update filtered products when the main list changes\n           if (provider.products.isNotEmpty) {\n             filteredProducts = provider.filterProducts(searchController.text);\n             _sortProducts();\n           }\n"
                },
                {
                    "date": 1764491589741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -182,9 +182,8 @@\n                     });\n                   },\n                 ),\n               ),\n-              // Loading Indicator or Product List\n               Expanded(\n                 child: provider.isLoading\n                     ? const Center(\n                         child: SpinKitCircle(color: Colors.blue, size: 50.0),\n"
                },
                {
                    "date": 1764491596520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -230,9 +230,8 @@\n           final result = await Navigator.push(\n             context,\n             NavigationUtils.createSlideRoute(const AddProductScreen()),\n           );\n-          // Refresh products when returning from add screen\n           if (result == true) {\n             _refreshProducts();\n           }\n         },\n"
                }
            ],
            "date": 1764487627021,
            "name": "Commit-0",
            "content": "// ignore_for_file: unnecessary_null_comparison\n\nimport 'package:flutter/material.dart';\nimport 'package:flutter_spinkit/flutter_spinkit.dart';\nimport 'package:provider/provider.dart';\n\nimport '../models/product.dart';\nimport '../providers/product_provider.dart';\nimport '../widgets/product_card.dart';\nimport 'add_product_screen.dart';\n\nclass ProductListScreen extends StatefulWidget {\n  const ProductListScreen({Key? key}) : super(key: key);\n\n  @override\n  State<ProductListScreen> createState() => _ProductListScreenState();\n}\n\nclass _ProductListScreenState extends State<ProductListScreen> {\n  late ProductProvider productProvider;\n  TextEditingController searchController = TextEditingController();\n  List<Product> filteredProducts = [];\n\n  @override\n  void initState() {\n    super.initState();\n    // Schedule the loading for after the build is complete\n    WidgetsBinding.instance.addPostFrameCallback((_) {\n      productProvider = Provider.of<ProductProvider>(context, listen: false);\n      productProvider.loadProducts();\n      productProvider.loadLocalProducts();\n    });\n    searchController.addListener(_filterProducts);\n  }\n\n  void _filterProducts() {\n    setState(() {\n      if (productProvider != null) {\n        filteredProducts = productProvider.filterProducts(\n          searchController.text,\n        );\n      }\n    });\n  }\n\n  @override\n  void dispose() {\n    searchController.removeListener(_filterProducts);\n    searchController.dispose();\n    super.dispose();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Products'),\n        backgroundColor: Theme.of(context).primaryColor,\n        foregroundColor: Colors.white,\n      ),\n      body: Consumer<ProductProvider>(\n        builder: (context, provider, child) {\n          // Initialize filtered products on first build\n          if (filteredProducts.isEmpty && provider.products.isNotEmpty) {\n            filteredProducts = List.from(provider.products);\n          }\n\n          // Set productProvider for use in other methods\n          productProvider = provider;\n\n          return Column(\n            children: [\n              // Search Bar\n              Padding(\n                padding: const EdgeInsets.all(12.0),\n                child: TextField(\n                  controller: searchController,\n                  decoration: InputDecoration(\n                    hintText: 'Search products...',\n                    prefixIcon: const Icon(Icons.search),\n                    border: OutlineInputBorder(\n                      borderRadius: BorderRadius.circular(30),\n                      borderSide: BorderSide.none,\n                    ),\n                    filled: true,\n                    fillColor: Colors.grey[200],\n                  ),\n                ),\n              ),\n              // Loading Indicator\n              if (provider.isLoading)\n                const Padding(\n                  padding: EdgeInsets.all(16.0),\n                  child: SpinKitCircle(color: Colors.blue, size: 50.0),\n                )\n              else if (provider.errorMessage.isNotEmpty)\n                Padding(\n                  padding: const EdgeInsets.all(16.0),\n                  child: Column(\n                    children: [\n                      Text(\n                        provider.errorMessage,\n                        style: const TextStyle(color: Colors.red),\n                      ),\n                      ElevatedButton(\n                        onPressed: () {\n                          provider.loadProducts();\n                        },\n                        child: const Text('Retry'),\n                      ),\n                    ],\n                  ),\n                )\n              else\n                // Product List\n                Expanded(\n                  child: RefreshIndicator(\n                    onRefresh: () async {\n                      await provider.loadProducts();\n                    },\n                    child: ListView.builder(\n                      itemCount: filteredProducts.length,\n                      itemBuilder: (context, index) {\n                        return ProductCard(product: filteredProducts[index]);\n                      },\n                    ),\n                  ),\n                ),\n            ],\n          );\n        },\n      ),\n      floatingActionButton: FloatingActionButton(\n        onPressed: () {\n          Navigator.push(\n            context,\n            MaterialPageRoute(builder: (context) => const AddProductScreen()),\n          ).then((value) {\n            // Refresh products when returning from add screen\n            if (value == true) {\n              productProvider.loadProducts();\n            }\n          });\n        },\n        backgroundColor: Theme.of(context).primaryColor,\n        child: const Icon(Icons.add),\n      ),\n    );\n  }\n}\n"
        }
    ]
}