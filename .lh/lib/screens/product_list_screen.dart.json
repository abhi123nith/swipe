{
    "sourceFile": "lib/screens/product_list_screen.dart",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764487627021,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764487627021,
            "name": "Commit-0",
            "content": "// ignore_for_file: unnecessary_null_comparison\n\nimport 'package:flutter/material.dart';\nimport 'package:flutter_spinkit/flutter_spinkit.dart';\nimport 'package:provider/provider.dart';\n\nimport '../models/product.dart';\nimport '../providers/product_provider.dart';\nimport '../widgets/product_card.dart';\nimport 'add_product_screen.dart';\n\nclass ProductListScreen extends StatefulWidget {\n  const ProductListScreen({Key? key}) : super(key: key);\n\n  @override\n  State<ProductListScreen> createState() => _ProductListScreenState();\n}\n\nclass _ProductListScreenState extends State<ProductListScreen> {\n  late ProductProvider productProvider;\n  TextEditingController searchController = TextEditingController();\n  List<Product> filteredProducts = [];\n\n  @override\n  void initState() {\n    super.initState();\n    // Schedule the loading for after the build is complete\n    WidgetsBinding.instance.addPostFrameCallback((_) {\n      productProvider = Provider.of<ProductProvider>(context, listen: false);\n      productProvider.loadProducts();\n      productProvider.loadLocalProducts();\n    });\n    searchController.addListener(_filterProducts);\n  }\n\n  void _filterProducts() {\n    setState(() {\n      if (productProvider != null) {\n        filteredProducts = productProvider.filterProducts(\n          searchController.text,\n        );\n      }\n    });\n  }\n\n  @override\n  void dispose() {\n    searchController.removeListener(_filterProducts);\n    searchController.dispose();\n    super.dispose();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Products'),\n        backgroundColor: Theme.of(context).primaryColor,\n        foregroundColor: Colors.white,\n      ),\n      body: Consumer<ProductProvider>(\n        builder: (context, provider, child) {\n          // Initialize filtered products on first build\n          if (filteredProducts.isEmpty && provider.products.isNotEmpty) {\n            filteredProducts = List.from(provider.products);\n          }\n\n          // Set productProvider for use in other methods\n          productProvider = provider;\n\n          return Column(\n            children: [\n              // Search Bar\n              Padding(\n                padding: const EdgeInsets.all(12.0),\n                child: TextField(\n                  controller: searchController,\n                  decoration: InputDecoration(\n                    hintText: 'Search products...',\n                    prefixIcon: const Icon(Icons.search),\n                    border: OutlineInputBorder(\n                      borderRadius: BorderRadius.circular(30),\n                      borderSide: BorderSide.none,\n                    ),\n                    filled: true,\n                    fillColor: Colors.grey[200],\n                  ),\n                ),\n              ),\n              // Loading Indicator\n              if (provider.isLoading)\n                const Padding(\n                  padding: EdgeInsets.all(16.0),\n                  child: SpinKitCircle(color: Colors.blue, size: 50.0),\n                )\n              else if (provider.errorMessage.isNotEmpty)\n                Padding(\n                  padding: const EdgeInsets.all(16.0),\n                  child: Column(\n                    children: [\n                      Text(\n                        provider.errorMessage,\n                        style: const TextStyle(color: Colors.red),\n                      ),\n                      ElevatedButton(\n                        onPressed: () {\n                          provider.loadProducts();\n                        },\n                        child: const Text('Retry'),\n                      ),\n                    ],\n                  ),\n                )\n              else\n                // Product List\n                Expanded(\n                  child: RefreshIndicator(\n                    onRefresh: () async {\n                      await provider.loadProducts();\n                    },\n                    child: ListView.builder(\n                      itemCount: filteredProducts.length,\n                      itemBuilder: (context, index) {\n                        return ProductCard(product: filteredProducts[index]);\n                      },\n                    ),\n                  ),\n                ),\n            ],\n          );\n        },\n      ),\n      floatingActionButton: FloatingActionButton(\n        onPressed: () {\n          Navigator.push(\n            context,\n            MaterialPageRoute(builder: (context) => const AddProductScreen()),\n          ).then((value) {\n            // Refresh products when returning from add screen\n            if (value == true) {\n              productProvider.loadProducts();\n            }\n          });\n        },\n        backgroundColor: Theme.of(context).primaryColor,\n        child: const Icon(Icons.add),\n      ),\n    );\n  }\n}\n"
        }
    ]
}